# Gmail Tray Notifier

Кроссплатформенное Tauri-приложение, которое висит в системном трее, проверяет непрочитанные письма Gmail и показывает кастомный полупрозрачный алерт 650×150 с кнопками «Перейти» и «Прочитано», а также воспроизводит звук уведомления.

## Возможности

- Авторизация через Google OAuth2 с использованием PKCE и локального редиректа `http://localhost:42813/oauth2callback`.
- Токены доступа хранятся в системном keychain (библиотека [`keyring`](https://crates.io/crates/keyring)).
- Очередь уведомлений: в интерфейсе всегда отображается только одно письмо, остальные ждут своей очереди.
- Кнопка «Перейти» открывает письмо в браузере, «Прочитано» снимает метку `UNREAD` с письма.
- Настраиваемый интервал опроса, путь до мелодии, громкость, автозапуск и кастомный запрос Gmail (например `is:unread category:primary`).
- Полупрозрачный алерт 650×150 px с автоскрытием через 9 секунд и паузой при наведении.
- Звуковое уведомление (поддерживаются локальные файлы `.mp3`/`.wav`).

## Структура проекта

```
frontend/            # Статический UI (основное окно и алерт)
src-tauri/           # Rust-бэкенд Tauri
  ├── src/
  │   ├── config.rs  # Работа с настройками
  │   ├── gmail.rs   # Клиент Gmail API и формирование уведомлений
  │   ├── notifier.rs# Очередь уведомлений и события для фронтенда
  │   ├── oauth.rs   # OAuth2 + хранение токенов в keychain
  │   └── main.rs    # Сборка приложения, системный трей, команды
  └── tauri.conf.json
```

## Подготовка OAuth2

1. В [Google Cloud Console](https://console.cloud.google.com/apis/credentials) создайте OAuth Client ID типа **Desktop App**.
2. Добавьте в настройках клиента авторизованный redirect URI: `http://localhost:42813/oauth2callback`.
3. Скопируйте `Client ID` и (опционально) `Client Secret` и вставьте их в настройках приложения (основное окно).

## Настройки

Настройки сохраняются в `settings.json` в директории конфигурации Tauri для вашей платформы:
- macOS: `~/Library/Application Support/com.example.gmailtray/settings.json`
- Windows: `%APPDATA%\com.example.gmailtray\settings.json`
- Linux: `~/.config/com.example.gmailtray/settings.json`

Параметры можно редактировать через UI или вручную (JSON):

```json
{
  "poll_interval_secs": 30,
  "sound_enabled": true,
  "sound_path": "/path/to/notify.wav",
  "auto_launch": true,
  "gmail_query": "is:unread category:primary",
  "oauth_client_id": "...",
  "oauth_client_secret": "...",
  "playback_volume": 0.7
}
```

## Сборка и запуск

> ⚠️ В песочнице, из которой сформирован этот репозиторий, нет доступа к npm и crates.io, поэтому `npm install`, `cargo check` или `cargo tauri dev` не удалось выполнить. Для локальной сборки выполните шаги ниже в собственной среде с доступом в интернет.

1. Установите зависимости Tauri согласно [официальной документации](https://tauri.app/v1/guides/getting-started/prerequisites/).
2. Установите `@tauri-apps/cli` (глобально или через `devDependencies`).
3. В корне проекта запустите:

```bash
cd src-tauri
cargo tauri dev
```

Или для сборки:

```bash
cargo tauri build
```

Фронтенд — статический, дополнительных сборок не требуется (используется `frontend/` как dev/dist каталог).

## Горячие клавиши и меню трея

- **Проверить сейчас** — немедленный опрос Gmail.
- **Войти в Gmail** — запуск OAuth2 в системном браузере.
- **Выйти** — удаляет токены и останавливает очередь уведомлений.
- **Выход из приложения** — завершает процесс.

## Диагностика

- Логи пишутся через `tracing` и доступны в стандартном выводе.
- Очередь уведомлений очищается после логаута.
- При ошибках сети приложение повторит запрос на следующем интервале.
