# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ "–û—Ç–ª–æ–∂–∏—Ç—å" - –§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–û—Ç–ª–æ–∂–∏—Ç—å" –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ—Å—Ç–∞–≤–∞–ª–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—á—Ç—É –¥–∞–∂–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å" –≤ —Ç—Ä–µ–µ –∏–ª–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø–æ—è–≤–ª—è–ª–∏—Å—å.

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ –±–∞–≥–∏

### 1. üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç—Ä–µ—è –≤—ã–∑—ã–≤–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–Ω—é —Ç—Ä–µ—è –¥–ª—è "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å" –≤—ã–∑—ã–≤–∞–ª –Ω–∞–ø—Ä—è–º—É—é `poll_once()` –≤–º–µ—Å—Ç–æ –∫–æ–º–∞–Ω–¥—ã `check_now()`.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–µ–∂–∏–º snooze –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–ª—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –≤ —Ç—Ä–µ–µ.

### 2. üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–µ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏ —Ñ—É–Ω–∫—Ü–∏–∏
–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `check_now` (MenuItem) –∑–∞—Ç–µ–Ω—è–ª–∞ —Ñ—É–Ω–∫—Ü–∏—é `check_now()`, –¥–µ–ª–∞—è –µ—ë –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π –≤ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ç—Ä–µ—è.

**–û—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏:**
```
error[E0618]: expected function, found `tauri::menu::MenuItem<...>`
let check_now = MenuItem::with_id(...)  ‚Üê –∑–∞—Ç–µ–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é
...
check_now(app_clone.clone(), ...)  ‚Üê –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–∑–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—é
```

### 3. –§—É–Ω–∫—Ü–∏—è snooze() –æ—á–∏—â–∞–ª–∞ –æ—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
–¢–µ–∫—É—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–µ—Ä—è–ª–∏—Å—å, –∏ –ø–∏—Å—å–º–∞ –ø–æ–º–µ—á–∞–ª–∏—Å—å –∫–∞–∫ "seen" –≤ –∫—ç—à–µ.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è MenuItem (—Å—Ç—Ä–æ–∫–∞ ~410)

**–ë—ã–ª–æ:**
```rust
let check_now = MenuItem::with_id(app, "check_now", "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å", ...)?;
...
let menu = MenuBuilder::new(app)
    .item(&check_now)  // ‚Üê –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
```

**–°—Ç–∞–ª–æ:**
```rust
let check_now_item = MenuItem::with_id(app, "check_now", "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å", ...)?;
...
let menu = MenuBuilder::new(app)
    .item(&check_now_item)  // ‚Üê –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç—Ä–µ—è (—Å—Ç—Ä–æ–∫–∞ ~446)

**–ë—ã–ª–æ:**
```rust
"check_now" => {
    let app_state = poll_handle.state::<AppState>().inner().clone();
    tauri::async_runtime::spawn(async move {
        if let Err(err) = app_state.poll_once(&poll_handle).await {
            warn!(%err, "manual poll failed");
        }
    });
}
```

**–°—Ç–∞–ª–æ:**
```rust
"check_now" => {
    info!("tray click: check_now");
    let app_clone = app_handle.clone();
    tauri::async_runtime::spawn(async move {
        // –í—ã–∑—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—É check_now, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç snooze
        if let Err(err) = check_now(app_clone.clone(), app_clone.state()).await {
            warn!(%err, "manual check failed");
        }
    });
}
```

### 3. –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è snooze() (—Å—Ç—Ä–æ–∫–∞ ~342)

**–ë—ã–ª–æ:**
```rust
*state.snooze_until.lock() = Some(...);
state.notifier.clear();  // ‚Üê –æ—á–∏—â–∞–ª–∞ –æ—á–µ—Ä–µ–¥—å!
if let Some(win) = app.get_webview_window("alert") {
    let _ = win.hide();
}
```

**–°—Ç–∞–ª–æ:**
```rust
*state.snooze_until.lock() = Some(...);
// –ù–ï –æ—á–∏—â–∞–µ–º –æ—á–µ—Ä–µ–¥—å - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è!
if let Some(win) = app.get_webview_window("alert") {
    let _ = win.hide();
}
```

### 4. –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è check_now() (—Å—Ç—Ä–æ–∫–∞ ~207)

–î–æ–±–∞–≤–ª–µ–Ω–æ:
- ‚úÖ –°–±—Ä–æ—Å —Ä–µ–∂–∏–º–∞ snooze
- ‚úÖ –ü–æ–∫–∞–∑ —Ç–µ–∫—É—â–µ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```rust
#[tauri::command]
async fn check_now(app: tauri::AppHandle, state: tauri::State<'_, AppState>) -> Result<(), String> {
    info!("check_now: manual check requested");
    
    // ...–ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º snooze
    let was_snoozed = state.snooze_until.lock().is_some();
    *state.snooze_until.lock() = None;
    if was_snoozed {
        info!("check_now: snooze cleared");
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    if let Some(notification) = state.notifier.current() {
        info!("check_now: showing current notification from queue");
        if let Some(win) = app.get_webview_window("alert") {
            let _ = win.show();
            let _ = win.set_focus();
            let _ = app.emit("gmail://notification", &notification);
        }
    } else {
        info!("check_now: no notification in queue");
    }

    info!("check_now: calling poll_once");
    state.poll_once(&app).await.map_err(|err| err.to_string())
}
```

### 5. –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è poll_once() (—Å—Ç—Ä–æ–∫–∞ ~51)

–î–æ–±–∞–≤–ª–µ–Ω–æ: –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è snooze –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

```rust
if let Some(until) = *self.snooze_until.lock() {
    if std::time::Instant::now() < until {
        debug!("gmail polling snoozed");
        return Ok(());
    } else {
        *self.snooze_until.lock() = None;
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è snooze
        if let Some(notification) = self.notifier.current() {
            if let Some(win) = app.get_webview_window("alert") {
                let _ = win.show();
                let _ = win.set_focus();
                let _ = app.emit("gmail://notification", &notification);
            }
        }
    }
}
```

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### `src-tauri/src/main.rs`
- **–°—Ç—Ä–æ–∫–∞ ~410**: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `check_now` ‚Üí `check_now_item`
- **–°—Ç—Ä–æ–∫–∞ ~421**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `check_now_item` –≤ –º–µ–Ω—é
- **–°—Ç—Ä–æ–∫–∞ ~446**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç—Ä–µ—è - –≤—ã–∑–æ–≤ `check_now()` —Ñ—É–Ω–∫—Ü–∏–∏
- **–°—Ç—Ä–æ–∫–∞ ~207**: –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `check_now()` —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **–°—Ç—Ä–æ–∫–∞ ~342**: –§—É–Ω–∫—Ü–∏—è `snooze()` –Ω–µ –æ—á–∏—â–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å
- **–°—Ç—Ä–æ–∫–∞ ~51**: –§—É–Ω–∫—Ü–∏—è `poll_once()` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ snooze

## –ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç

### ‚úÖ –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–û—Ç–ª–æ–∂–∏—Ç—å":
1. –û–∫–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–∞–π–º–µ—Ä snooze
3. **–û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** (–Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è)
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è

### ‚úÖ –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å" –≤ —Ç—Ä–µ–µ:
1. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `check_now()` (–Ω–µ `poll_once()`)
2. –†–µ–∂–∏–º snooze —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
3. –¢–µ–∫—É—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
4. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –ø–∏—Å–µ–º
5. –ù–æ–≤—ã–µ ÔøΩÔøΩ–∏—Å—å–º–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å

### ‚úÖ –ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è snooze:
1. –†–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
2. –¢–µ–∫—É—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å" –≤ —Ç—Ä–µ–µ —Ç–µ–ø–µ—Ä—å –≤–∏–¥–Ω–æ:

```
INFO  tray click: check_now
INFO  check_now: manual check requested
INFO  check_now: snooze cleared
INFO  check_now: showing current notification from queue
INFO  check_now: calling poll_once
```

–ü—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö –≤–æ –≤—Ä–µ–º—è snooze:
```
DEBUG gmail polling snoozed
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. ‚úÖ **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
2. ‚úÖ **–ü–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** –æ –ø–∏—Å—å–º–µ
3. ‚úÖ **–ù–∞–∂–º–∏—Ç–µ "–û—Ç–ª–æ–∂–∏—Ç—å"** ‚Üí –æ–∫–Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è
4. ‚úÖ **–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å" –≤ —Ç—Ä–µ–µ**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç `check_now`
   - –û–∫–Ω–æ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å —Ç–µ–º –∂–µ –ø–∏—Å—å–º–æ–º
5. ‚úÖ **–ù–∞–∂–º–∏—Ç–µ "–û—Ç–ª–æ–∂–∏—Ç—å" —Å–Ω–æ–≤–∞**
6. ‚úÖ **–î–æ–∂–¥–∏—Ç–µ—Å—å –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ snooze** ‚Üí –æ–∫–Ω–æ –ø–æ—è–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –°—Ç–∞—Ç—É—Å —Å–±–æ—Ä–∫–∏

‚úÖ **–£–°–ü–ï–®–ù–û**
```
Compiling gmail_tray_notifier v0.1.0
Finished `dev` profile [unoptimized + debuginfo] target(s) in 8.47s
```

‚ö†Ô∏è 4 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ):
- –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –º–µ—Ç–æ–¥ `path` –≤ config.rs
- –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –ø–æ–ª–µ `internal_date` –≤ gmail.rs
- –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `NotificationResult` –≤ notifier.rs
- –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏—è `notify_dismissed` –≤ notifier.rs

## –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2025-11-27

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **v1**: –ü–æ–ø—ã—Ç–∫–∞ —Å–±—Ä–æ—Å–∞ snooze –≤ check_now (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ –∏–∑-–∑–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ç—Ä–µ—è)
- **v2**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç—Ä–µ—è (–æ—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ - –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–µ–Ω)
- **v3 (–§–ò–ù–ê–õ)**: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è MenuItem, –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

