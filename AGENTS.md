# Руководство по репозиторию

## Структура проекта и модули
- `frontend/` — статический интерфейс (окно трея и экран настроек). Работайте напрямую с `main.js` и `styles.css`; в дев-режиме сборщик не используется.
- `src-tauri/` — бэкенд на Rust. В `src/` лежат основные файлы: `oauth.rs`, `gmail.rs`, `notifier.rs`, `config.rs`, `main.rs`, а конфигурация приложения описана в `tauri.conf.json`.
- `scripts/` содержит установочные скрипты (`setup.ps1`, `setup.sh`), которые подтягивают зависимости и складывают готовые сборки в `release/`.
- Все артефакты из `src-tauri/target/` считаются временными и не коммитятся.

## Сборка, тесты и разработка
- `pwsh -File .\scripts\setup.ps1 -Auto -Dev` (Windows) и `bash scripts/setup.sh --auto --dev` (Linux) разворачивают окружение и запускают приложение в dev-режиме.
- `cd src-tauri && cargo tauri dev` запускает рабочее окно с автоперезапуском; отслеживайте логи `tracing` в терминале.
- `cd src-tauri && cargo tauri build` собирает установщики и копирует артефакты в `release/`.
- `cd src-tauri && cargo check` — быстрый контроль перед открытием PR.

## Стиль кода и соглашения
- Используем Rust edition 2021. Перед коммитом выполняйте `cargo fmt` и `cargo clippy --all-targets -- -D warnings` из каталога `src-tauri/`.
- Названия структур и перечислений делайте говорящими, функции — в `snake_case`, константы — в `SCREAMING_SNAKE_CASE`. Модули держите по областям ответственности (конфиг, OAuth, клиент Gmail, очередь уведомлений).
- Во фронтенд-скриптах придерживайтесь отступов в две пробела, обязательных точек с запятой и `const` там, где возможно. Код основывается на чистом DOM — внедрение фреймворков предварительно согласовываем.

## Тестирование
- Размещайте `#[cfg(test)]` в конце каждого Rust-файла и давайте тестам осмысленные имена вроде `handles_refresh_token_loss`.
- `cd src-tauri && cargo test` покрывает модульные проверки. При изменениях OAuth/Gmail имитируйте HTTP через утилиты из `oauth2`.
- Перед ревью проводите ручной смоук-тест: вход, опрос непрочитанных, кнопки уведомления, команды в трее.

## Коммиты и Pull Request
- Поддерживайте стиль истории: короткие сообщения в настоящем времени (часто на русском), например «Обновляю обработку OAuth». Несвязанные правки разделяйте.
- В PR описывайте изменения, перечисляйте ручные проверки и привязывайте задачи. При затронутом UI прикладывайте скриншоты или короткие видео и звайте ревьюеров по Rust и фронтенду, если правки охватывают обе части.

## Безопасность и конфигурация
- Не коммитьте OAuth Client Secret. Секреты храните в настройках приложения или в локальных файлах, игнорируемых git.
- Для отладки используйте временные учётные данные, а по завершении отзывайте их. Убедитесь, что редирект остаётся `http://localhost:42813/oauth2callback`.
