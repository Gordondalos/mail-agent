# План реализации: Трей-уведомитель почты (Gmail OAuth)

**Ветка**: `001-gmail-oauth-notifier` | **Дата**: 2025-10-24 | **Спецификация**: C:\\project\\mail-agent\\specs\\001-gmail-oauth-notifier\\spec.md
**Ввод**: Спецификация фичи: `C:\\project\\mail-agent\\specs\\001-gmail-oauth-notifier\\spec.md`

**Примечание**: Изначальный шаблон сформирован `/speckit.plan`.

## Резюме

Десктопное приложение в трее авторизуется через OAuth, опрашивает
непрочитанные письма и показывает оверлей 800×150 с действиями «Просмотреть» и
«Пропустить». Оверлей не автоскрывается — требуется действие пользователя. UI —
Angular (последняя) + Angular Material (последняя). Бэкенд — Rust (Tauri).
Решения исследования: политика OAuth-first (с паролем приложения при отсутствии
OAuth), очередь уведомлений по одному, условная видимость полей пароля.

## Технический контекст

<!--
  ACTION REQUIRED: Replace the content in this section with the technical details
  for the project. The structure here is presented in advisory capacity to guide
  the iteration process.
-->

**Языки/версии**: Rust (edition 2021), Tauri (latest), Angular (latest), Angular Material (latest)  
**Основные зависимости**: Google OAuth2 (PKCE), keyring, Angular Material компоненты  
**Хранение**: системный keychain для токенов; локальный конфиг для настроек  
**Тестирование**: `cargo test` (Rust); ручной смоук (авторизация, опрос, алерты); UI E2E — TBD  
**Целевая платформа**: Windows, Linux, macOS (десктоп, трей)
**Тип проекта**: Десктоп — бэкенд на Rust (`src-tauri/`), фронтенд — Angular (`frontend/`)  
**Цели производительности**: показ алерта ≤ 5с от следующего цикла опроса; отзывчивость UI < 100мс  
**Ограничения**: без секретов в логах; размер оверлея 800×150; без автоскрытия (нужно действие); офлайн — корректные ретраи  
**Масштаб/объём**: однопользовательский клиент; стартовый провайдер: Gmail

## Проверка конституции

*GATE: должен пройти до начала исследований. Повторная проверка после дизайна.*

- Безопасность/секреты: ПРОХОД — токены в keychain; секреты не попадают в VCS.
- Стиль/инструменты: ПРОХОД С ОБОСНОВАНИЕМ — внедрение Angular + Material
  согласовано продуктово (см. «Согласование фреймворка» ниже).
- Тестирование: ПРОХОД — юнит-тесты Rust; ручной смоук-флоу.
- Сборка/релиз: ПРОХОД — скрипты setup; `cargo tauri dev/build`.
- Наблюдаемость/простота: ПРОХОД — `tracing` для auth/poll/queue/actions.
- Язык документации: ПРОХОД — документы локализованы на русский.

Итог: ПРОХОД (обоснования отражены в «Сложность/исключения»).

### Согласование фреймворка

- Angular + Angular Material: одобрено. Ссылка на артефакт: TODO(APPROVAL_LINK)

## Структура проекта

### Документация (данная фича)

```text
src-tauri/
└── src/
    ├── config.rs
    ├── gmail.rs
    ├── notifier.rs
    ├── oauth.rs
    └── main.rs

frontend/  (Angular)
└── src/
    ├── app/
    │   ├── components/
    │   │   ├── tray-window/
    │   │   ├── settings-page/
    │   │   └── notification-overlay/
    │   ├── services/
    │   └── app.config.ts
    └── assets/
```

**Решение по структуре**: двухкомпонентное приложение — бэкенд Rust в `src-tauri/`,
фронтенд Angular в `frontend/`. Бэкенд-модули сохраняются, фронтенд добавляет
инфраструктуру Angular.

## Сложность/исключения (Complexity Tracking)

> **Fill ONLY if Constitution Check has violations that must be justified**

| Исключение | Зачем нужно | Почему отвергнута более простая альтернатива |
|------------|-------------|----------------------------------------------|
| Внедрение Angular | Явное требование продукта; богатые UI-компоненты | Чистый DOM без Material-компонентов/теминга недостаточен |
| Оверлей без автоскрытия | Контроль пользователем, соответствие требованиям | Автоскрытие ведёт к пропуску действий |
