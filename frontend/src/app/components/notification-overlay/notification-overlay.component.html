<div
  class="alert-shell"
  appTauriDragWindow
  data-tauri-drag-region
  *ngIf="current() as n"
  (dblclick)="toggleExpand()"
>
  <div class="alert-card">
    <button
      class="alert-close"
      type="button"
      aria-label="Отложить уведомление"
      (click)="snooze()"
      data-tauri-drag-region="false"
    >
      <mat-icon>close</mat-icon>
    </button>
    <div class="alert-content" data-tauri-drag-region="false">

      <div class="alert-title">
        {{ n.subject || '(без темы)' }}
        <span class="alert-date" *ngIf="n.receivedAt as received">
          {{ formatDate(received) }}
        </span>
        <span class="alert-hint" *ngIf="!isExpanded()" title="Двойной клик для развертывания">⤢</span>
      </div>
      <div class="alert-sender" *ngIf="n.sender">
        <strong>От:</strong> {{ decodeHtmlEntities(n.sender) }}
      </div>
      <div class="alert-recipient" *ngIf="n.recipient">
        <strong>Кому:</strong> {{ decodeHtmlEntities(n.recipient) }}
      </div>
      <div class="alert-snippet" *ngIf="!isExpanded()">{{ n.snippet || '' }}</div>

      <!-- Развёрнутое содержимое письма -->
      <div class="alert-body" *ngIf="isExpanded()">
        <!-- Debug info -->
        <div style="background: #f0f0f0; padding: 8px; margin-bottom: 8px; font-size: 0.8em; border: 1px solid #ccc;">
          <strong>Debug:</strong> isExpanded={{ isExpanded() }}, hasBody={{ !!n.body }}, bodyLength={{ n.body?.length || 0 }}
        </div>
        <div *ngIf="n.body" [innerHTML]="getSafeBody(n.body)"></div>
        <p *ngIf="!n.body" style="color: #94a3b8; font-style: italic;">Содержимое письма недоступно</p>
      </div>
    </div>
    <div class="alert-actions" data-tauri-drag-region="false">
      <button class="open" (click)="open()">Перейти</button>
      <button class="read" (click)="markRead()">Прочитано</button>
      <button class="snooze" (click)="snooze()">Отложить</button>
    </div>
  </div>
</div>
